version: '3'
services:
    postgis:
        image: kartoza/postgis:latest
        environment:
            - POSTGRES_DBNAME=geodjango
            - POSTGRES_USER=geo
            - POSTGRES_PASS=geo
            - ALLOW_IP_RANGE=0.0.0.0/0
        restart: unless-stopped
#        networks:
#            - backend
#        ports:
#            - 5432:5432
#            - 1234:1234
    iotsite:
        build: .
        depends_on:
            - postgis
        working_dir: /app
        command: bash -c "./manage.py install_frontend_dependencies &&
                          ./manage.py build_frontend &&
                          ./manage.py wait_for_db 2> /dev/null &&
                          ./manage.py makemigrations &&
                          ./manage.py migrate &&
                          ./manage.py runserver 0.0.0.0:8000"
        volumes:
            - ./:/app
        ports:
            - 8080:8000
        restart: unless-stopped

#        networks:
#            - backend
#networks:
#    backend:
